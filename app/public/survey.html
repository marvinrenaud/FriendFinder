<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.css" />
  <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" integrity="sha384-HzUaiJdCTIY/RL2vDPRGdEQHHahjzwoJJzGUkYjHVzTwXFQ2QN/nVgX7tzoMW3Ov" crossorigin="anonymous">
  <script src="https://use.fontawesome.com/9efa8a51cb.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css">
  <title>FriendFinder | Survey</title>
</head>

<body>

  <div class="container">
    <h1>Friend Finder Survey</h1>
    <p>All fields are required</p>
    <hr>
    <form id="friendForm">
      <h2>About You</h2>
      <div class="form-group">
        <label for="friendName">Name</label>
        <input type="text" class="form-control" id="friendName" placeholder="Jane Doe">
      </div>
      <div class="form-group">
        <label for="friendPic">Link to photo image</label>
        <input type="text" class="form-control" id="imageLink" placeholder="http://samplephoto.jpg">
      </div>
      <hr>
      <div class="form-group">
        <label for="question1"><h4 class="question">Q1: Your mind is always buzzing with unexplored ideas and plans.</h4></label>
        <select class="form-control" id="q01">
        <option class="dropdown-header">Please select a response</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>
      </div>
      <div class="form-group">
        <label for="question2"><h4 class="question">Q2: Generally speaking, you rely more on your experience than your imagination.</h4></label>
        <select class="form-control" id="q02">
        <option class="dropdown-header">Please select a response</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>
      </div>
      <div class="form-group">
        <label for="question3"><h4 class="question">Q3: You find it easy to stay relaxed and focused even when there is some pressure.</h4></label>
        <select class="form-control" id="q03">
        <option class="dropdown-header">Please select a response</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>
      </div>
      <div class="form-group">
        <label for="question4"><h4 class="question">Q4: You rarely do something just out of sheer curiosity.</h4></label>
        <select class="form-control" id="q04">
        <option class="dropdown-header">Please select a response</option>
        <option value="1">1 (Strongly Disagree)</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5 (Strongly Agree)</option>
      </select>
      </div>
      <div class="form-group">
        <label for="question5"><h4 class="question">Q5: People can rarely upset you.</h4></label>
        <select class="form-control" id="q05">
            <option class="dropdown-header">Please select a response</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>
      </div>
      <div class="form-group">
        <label for="question6"><h4 class="question">Q6: It is often difficult for you to relate to other people’s feelings.</h4></label>
        <select class="form-control" id="q06">
            <option class="dropdown-header">Please select a response</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>
      </div>
      <div class="form-group">
        <label for="question7"><h4 class="question">Q7: In a discussion, truth should be more important than people’s sensitivities.</h4></label>
        <select class="form-control" id="q07">
            <option class="dropdown-header">Please select a response</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>
      </div>
      <div class="form-group">
        <label for="question8"><h4 class="question">Q8: You rarely get carried away by fantasies and ideas.</h4></label>
        <select class="form-control" id="q08">
            <option class="dropdown-header">Please select a response</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>
      </div>
      <div class="form-group">
        <label for="question9"><h4 class="question">Q9: You think that everyone’s views should be respected regardless of whether they are supported by facts or not.</h4></label>
        <select class="form-control" id="q09">
            <option class="dropdown-header">Please select a response</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>
      </div>
      <div class="form-group">
        <label for="question10"><h4 class="question">Q10: You feel more energetic after spending time with a group of people.</h4></label>
        <select class="form-control" id="q10">
            <option class="dropdown-header">Please select a response</option>
            <option value="1">1 (Strongly Disagree)</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5 (Strongly Agree)</option>
          </select>
      </div>
      <hr>
      <button type="submit" class="btn btn-success" id="submitButton">Submit</button>
    </form>
    <br>
    <br>
    <div>
      <p> <a href="./api/friends">API Friends List</a> | <a href="https://github.com/marvinrenaud/FriendFinder">GIT Hub Repo</a> </p>
    </div>


  </div>

  <!-- Below code houses the modal -->
  <div class="modal fade" tabindex="-1" role="dialog" id="myModal">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Viola! Your New Best Friend!!!</h4>
        </div>
        <div class="modal-body">
          <div id="bffName"></div>
          <div id="bffPic"></div>
          <br>
          <p>Have fun <i class="fa fa-venus-mars" aria-hidden="true"></i></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->




  <script type="text/javascript">
    // Create an object constructor to generate a user with responses
    var friendProfile = function(name, picture, responseObj) {
      this.name = name;
      this.picture = picture;
      this.responseObj = responseObj;
    };

    // Create global variables including those to hold responses to questions
    var friendName = "";
    var imageLink = "";
    var newFriendObj;
    var friendPoints = 0;
    var bestFriendPoints = 50;
    var bestFriendName = "";
    var bestFriendImage = "";
    var q01Answer = 0;
    var q02Answer = 0;
    var q03Answer = 0;
    var q04Answer = 0;
    var q05Answer = 0;
    var q06Answer = 0;
    var q07Answer = 0;
    var q08Answer = 0;
    var q09Answer = 0;
    var q10Answer = 0;
    var responses = [];

    // Capture submit and store integers for each response
    $("#submitButton").on("click", function() {
      event.preventDefault();
      friendName = $("#friendName").val().trim();
      imageLink = $("#imageLink").val().trim();
      q01Answer = parseInt($("#q01").val().trim());
      q02Answer = parseInt($("#q02").val().trim());
      q03Answer = parseInt($("#q03").val().trim());
      q04Answer = parseInt($("#q04").val().trim());
      q05Answer = parseInt($("#q05").val().trim());
      q06Answer = parseInt($("#q06").val().trim());
      q07Answer = parseInt($("#q07").val().trim());
      q08Answer = parseInt($("#q08").val().trim());
      q09Answer = parseInt($("#q09").val().trim());
      q10Answer = parseInt($("#q10").val().trim());

      // Add responses to the Responses array
      responses.push(q01Answer, q02Answer, q03Answer, q04Answer, q05Answer,
        q06Answer, q07Answer, q08Answer, q09Answer, q10Answer);

      // Create a object for the friend using the constructor created above
      newFriendObj = new friendProfile(friendName, imageLink, responses);
      console.log(newFriendObj);
      console.log(newFriendObj.responseObj);

      // Reset the friend finder form
      $("#friendForm")[0].reset();
      findFriend(newFriendObj);
    });

    function findFriend(newFriendObj) {
      var currentURL = window.location.origin;

      $.ajax({
          url: currentURL + "/api/friends",
          method: "GET"
        })
        .done(function(friends) {
          console.log("Friend from DB Name: ", friends[3].name, "Responses: ", friends[3].responseObj);
          console.log("New friend: ", newFriendObj);

          for (var j = 0; j < friends.length; j++) {
            friendPoints = 0;

            for (var i = 0; i < newFriendObj.responseObj.length; i++) {
              var friendPointsTemp = Math.abs(newFriendObj.responseObj[i] - friends[j].responseObj[i]);
              console.log("Here's the point spread for ", friends[j].name, " : ", friendPointsTemp);
              friendPoints += friendPointsTemp
              console.log("New friendPoints: ", friendPoints);
            }

            if (friendPoints <= bestFriendPoints) {
              bestFriendPoints = friendPoints;
              bestFriendName = friends[j].name;
              bestFriendImage = friends[j].photo;
            };
          }
          console.log("Best friend is: ", bestFriendName);
          showModal();


        });
    };

    function showModal() {
      $('#myModal').modal();
      $("#bffName").html('<h4>'+bestFriendName+'</h4>');
      $("#bffPic").html('<img src='+bestFriendImage+ ' alt=bestFriend style="max-width:200px; max-height:300px;">');
    }
  </script>

</body>

</html>
